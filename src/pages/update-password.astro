---
import AuthLayout from "@/layouts/AuthLayout.astro";
import { PasswordUpdateForm } from "@/components/auth/PasswordUpdateForm";

export const prerender = false;

// Handle password recovery code from URL
// When user clicks the reset link, Supabase includes ?code=... in URL
// We need to exchange this code for a session before the form can update password
const code = Astro.url.searchParams.get("code");

if (code) {
  const { error } = await Astro.locals.supabase.auth.exchangeCodeForSession(code);

  if (error) {
    console.error("[update-password] Failed to exchange code for session:", error.message);
    // Note: We don't redirect here - let the form show the error when user submits
  }
}
---

<AuthLayout title="Zmiana hasÅ‚a - PresMinder">
  <PasswordUpdateForm client:only="react" />
</AuthLayout>
